# Charge analysis - Bader charge
* The atomic charge can be calculted with *Bader's method*. This charge is called **Bader charge**.
* The positive charge means atoms are positively charged (cationic), and negative charge means anionic atoms.

## INCAR
* It is always better to calculate the Bader charge with *all-electron charge density*, i.e. valence and core electrons.
* VASP usually doesn't give all electron charge density (valence only) so following INCAR tag is needed.
    + `LCHARG = .TRUE.`
    + `LAECHG = .TRUE.`
* This generates the files `AECCAR0` and `AECCAR2`.

## Making Bader charge sum with VTST script
### Preparation
#### VTST script
1. Download VTST scripts from Henkelman group (in University of Texas): https://theory.cm.utexas.edu/code/vtstscripts.tgz
2. Extract by `tar zxvf vtstscripts.tgz`

#### Bader
1. Download bader: https://theory.cm.utexas.edu/henkelman/code/bader/download/bader.tar.gz
2. Extract by `tar zxvf bader.tar.gz`
3. `cd bader`
4. `cp makefile.lnx_ifort Makefile`
5. `make`
6. `module load intel` (when using supercomputer)
7. Done. Command file for Bader analysis is `bader` in that directory.

### Making CHGCAR_sum
* Make all-electron CHGCAR by `vtstscript/chgsum.pl AECCAR0 AECCAR2`
    + `CHGCAR_sum` should be generated
* `bader CHGCAR -ref CHGCAR_sum`
    + Files like `ACF.dat` or `BCF.dat` are generated.
    + Bader charge is written in **ACF.dat**.
    + "CHARGE" colum gives **the number of valence electrons** for each atom in that system (so the value is "electron population" rather than "charge").
    + To calculate the charge, the number of valence electrons (in atom) should be subtracted.
    + This value is written in *ZVAL in POTCAR*.

    $$
    {\rm charge} = -(N_{\text{electron in molecule}} - {\rm ZVAL})
    $$

# Charge density

### Visualizing charge density
* Charge density can be visualized by using **VESTA** and **CHGCAR** file, which is generated by VASP calculation.

1. With VESTA, open `CHGCAR`
2. Adjust isosurface values with "Objects" --> "Property" --> "Isosurface". Positive means negative charge.

* The unit of charge densities input by VESTA is $\rm{Bohr}^{-3}$.

#### 2 dimensional (plane) plot
* "Utilities" --> "2D Data Display"
* Define the plane with "Slice". Select three atoms in the plane. Miller index also can be used.

#### Charge density difference with VESTA
* Calculate "adsorbate + surface", "adsorbate", and "surface".
* Prepare `CHGCAR` files for each.
* "Edit" --> "Edit Data" --> "Volumetric data" -> "Import" then import `CHGCAR` file for "adsorbate + surface".
* After that, subtract the CHGCAR file of adsrobate. Repeat the same thing for surface `CHGCAR`.
* You need to define temporary directory because VESTA only accept the `CHGCAR`-named file.

Ref: http://renqinzhang.weebly.com/uploads/9/6/1/9/9619514/charge_density_difference.pdf

#### Plotting the spin density with VESTA
1. Do spin-polarized calculation by setting `ISPIN = 2` and `LCHARG = .TRUE.` in `INCAR`.
2. Confirm that `CHGCAR` is generated.
3. `vtstscripts/chgsplit.pl CHGCAR` --> `CHGCAR_tot` and `CHGCAR_mag` are generated
4. Copy `CHGCAR_mag` to `tmpCHGCAR` (any xxxCHGCAR filename is OK) and load with VESTA.